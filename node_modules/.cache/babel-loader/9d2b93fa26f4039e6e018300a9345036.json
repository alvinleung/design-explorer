{"ast":null,"code":"var _jsxFileName = \"/Users/alvinleung/Google Drive/Projects/alvinleung-portfolio/design-explorer/src/components/designExplorer/viewport/Viewport.js\";\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport \"./Viewport.scss\"; // global variables in this component\n\nlet cameraPosition = {\n  x: 0,\n  y: 0\n};\nlet zoom = 0; // Canvas Implementation of the\n\nfunction Viewport(props) {\n  const canvasWidth = 1920;\n  const canvasHeight = 1080;\n  const canvasRef = useRef(null);\n  const [imgLoaded, setImageLoaded] = useState(false);\n  useEffect(() => {\n    // initialise the canvas\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\"); // Load the svg files\n\n    let loadedImage = 0;\n    const imgList = props.src.map(imgUrl => {\n      const img = new Image();\n      img.src = imgUrl;\n      img.addEventListener(\"load\", () => {\n        console.log(\"Viewport loaded image: \" + imgUrl);\n        loadedImage++;\n\n        if (loadedImage === imgList.length) {\n          // all the image is loaded\n          setImageLoaded(true);\n          console.log(\"All images loaded\");\n        }\n      });\n      return img;\n    }); // canvas update\n\n    const update = deltaTime => {\n      updateLogic(cameraPosition, zoom); // clear the canvas\n\n      ctx.clearRect(0, 0, window.innerHeight, window.innerWidth); // render the content\n\n      repaintCanvas(ctx, imgList, cameraPosition, zoom);\n      requestAnimationFrame(update);\n    }; // begin the update cycle\n\n\n    update();\n  }, []); // the only way that the canvas code can access these var :(\n\n  cameraPosition = props.cameraPosition;\n  zoom = props.zoom;\n  return /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    width: canvasWidth,\n    height: canvasHeight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 10\n    }\n  });\n} // ================================+\n// CODE FOR RENDERING STUFF ON CANVAS\n// ================================+\n\n\nlet currentZoom = 0;\nlet currentCameraPos = {\n  x: 0,\n  y: 0\n};\nlet currentCameraVel = {\n  x: 0,\n  y: 0\n};\n\nfunction updateLogic(targetCameraPosition, targetZoom) {\n  // currentCameraPos.x = targetCameraPosition.x;\n  // currentCameraPos.y = targetCameraPosition.y;\n  currentZoom = targetZoom;\n  currentCameraVel.x = (targetCameraPosition.x - currentCameraPos.x) * 0.3;\n  currentCameraVel.y = (targetCameraPosition.y - currentCameraPos.y) * 0.3;\n  currentCameraPos.x += currentCameraVel.x;\n  currentCameraPos.y += currentCameraVel.y;\n}\n\nfunction repaintCanvas(ctx, imgs, cameraPosition, zoom) {\n  // prepare transformation for camera movement\n  ctx.save(); // move camera\n\n  ctx.translate(currentCameraPos.x, currentCameraPos.y);\n  ctx.scale(currentZoom, currentZoom); // render images\n\n  renderImages(ctx, imgs); // reset transformation\n\n  ctx.restore();\n  ctx.fillText(\"camera x \" + cameraPosition.x, 10, 50);\n  ctx.fillText(\"camera y \" + cameraPosition.y, 10, 65);\n} // pre render a low fedelity version of the image when zoom to acheive the smooth animation\n\n\nlet lowFidelityImages = [];\n\nfunction preRenderLowFidelityImages(imgList) {// the low fidleity one is half the size of the original\n}\n\nfunction renderImages(ctx, imgs) {\n  const paddingBetweenImages = 0;\n  let currentDrawY = 0;\n\n  for (let i = 0; i < imgs.length; i++) {\n    // render all the images\n    ctx.drawImage(imgs[i], 0, currentDrawY);\n    currentDrawY += imgs[i].height + paddingBetweenImages;\n  }\n}\n\nfunction clamp(value, min, max) {\n  if (value < min) return min;\n  if (value > max) return max;\n  return value;\n}\n\nexport default Viewport; //resources\n// using SVG and canvas\n// https://levelup.gitconnected.com/draw-an-svg-to-canvas-and-download-it-as-image-in-javascript-f7f7713cf81f\n// using canvas and react hooks\n// https://itnext.io/using-react-hooks-with-canvas-f188d6e416c0","map":{"version":3,"sources":["/Users/alvinleung/Google Drive/Projects/alvinleung-portfolio/design-explorer/src/components/designExplorer/viewport/Viewport.js"],"names":["React","useState","useRef","useEffect","useCallback","cameraPosition","x","y","zoom","Viewport","props","canvasWidth","canvasHeight","canvasRef","imgLoaded","setImageLoaded","canvas","current","ctx","getContext","loadedImage","imgList","src","map","imgUrl","img","Image","addEventListener","console","log","length","update","deltaTime","updateLogic","clearRect","window","innerHeight","innerWidth","repaintCanvas","requestAnimationFrame","currentZoom","currentCameraPos","currentCameraVel","targetCameraPosition","targetZoom","imgs","save","translate","scale","renderImages","restore","fillText","lowFidelityImages","preRenderLowFidelityImages","paddingBetweenImages","currentDrawY","i","drawImage","height","clamp","value","min","max"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport \"./Viewport.scss\";\n\n// global variables in this component\nlet cameraPosition = { x: 0, y: 0 };\nlet zoom = 0;\n\n// Canvas Implementation of the\nfunction Viewport(props) {\n  const canvasWidth = 1920;\n  const canvasHeight = 1080;\n\n  const canvasRef = useRef(null);\n\n  const [imgLoaded, setImageLoaded] = useState(false);\n\n  useEffect(() => {\n    // initialise the canvas\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n\n    // Load the svg files\n    let loadedImage = 0;\n    const imgList = props.src.map((imgUrl) => {\n      const img = new Image();\n      img.src = imgUrl;\n      img.addEventListener(\"load\", () => {\n        console.log(\"Viewport loaded image: \" + imgUrl);\n        loadedImage++;\n\n        if (loadedImage === imgList.length) {\n          // all the image is loaded\n          setImageLoaded(true);\n          console.log(\"All images loaded\");\n        }\n      });\n\n      return img;\n    });\n\n    // canvas update\n    const update = (deltaTime) => {\n      updateLogic(cameraPosition, zoom);\n\n      // clear the canvas\n      ctx.clearRect(0, 0, window.innerHeight, window.innerWidth);\n      // render the content\n      repaintCanvas(ctx, imgList, cameraPosition, zoom);\n      requestAnimationFrame(update);\n    };\n\n    // begin the update cycle\n    update();\n  }, []);\n\n  // the only way that the canvas code can access these var :(\n  cameraPosition = props.cameraPosition;\n  zoom = props.zoom;\n\n  return <canvas ref={canvasRef} width={canvasWidth} height={canvasHeight} />;\n}\n\n// ================================+\n// CODE FOR RENDERING STUFF ON CANVAS\n// ================================+\n\nlet currentZoom = 0;\nlet currentCameraPos = { x: 0, y: 0 };\nlet currentCameraVel = { x: 0, y: 0 };\nfunction updateLogic(targetCameraPosition, targetZoom) {\n  // currentCameraPos.x = targetCameraPosition.x;\n  // currentCameraPos.y = targetCameraPosition.y;\n  currentZoom = targetZoom;\n\n  currentCameraVel.x = (targetCameraPosition.x - currentCameraPos.x) * 0.3;\n  currentCameraVel.y = (targetCameraPosition.y - currentCameraPos.y) * 0.3;\n\n  currentCameraPos.x += currentCameraVel.x;\n  currentCameraPos.y += currentCameraVel.y;\n}\nfunction repaintCanvas(ctx, imgs, cameraPosition, zoom) {\n  // prepare transformation for camera movement\n  ctx.save();\n\n  // move camera\n  ctx.translate(currentCameraPos.x, currentCameraPos.y);\n  ctx.scale(currentZoom, currentZoom);\n\n  // render images\n  renderImages(ctx, imgs);\n\n  // reset transformation\n  ctx.restore();\n\n  ctx.fillText(\"camera x \" + cameraPosition.x, 10, 50);\n  ctx.fillText(\"camera y \" + cameraPosition.y, 10, 65);\n}\n\n// pre render a low fedelity version of the image when zoom to acheive the smooth animation\nlet lowFidelityImages = [];\nfunction preRenderLowFidelityImages(imgList) {\n  // the low fidleity one is half the size of the original\n}\n\nfunction renderImages(ctx, imgs) {\n  const paddingBetweenImages = 0;\n  let currentDrawY = 0;\n  for (let i = 0; i < imgs.length; i++) {\n    // render all the images\n    ctx.drawImage(imgs[i], 0, currentDrawY);\n\n    currentDrawY += imgs[i].height + paddingBetweenImages;\n  }\n}\n\nfunction clamp(value, min, max) {\n  if (value < min) return min;\n  if (value > max) return max;\n  return value;\n}\n\nexport default Viewport;\n\n//resources\n\n// using SVG and canvas\n// https://levelup.gitconnected.com/draw-an-svg-to-canvas-and-download-it-as-image-in-javascript-f7f7713cf81f\n\n// using canvas and react hooks\n// https://itnext.io/using-react-hooks-with-canvas-f188d6e416c0\n"]},"metadata":{},"sourceType":"module"}